---
title: "Aufgabe 2"
author: "windijon"
date: '2022-04-29'
output: html_document
---

### Task 1: Import your data

Load the necessary libraries.

```{r}

library(readr)        # to import tabular data (e.g. csv)
library(dplyr)        # to manipulate (tabular) data
library(ggplot2)      # to visualize data
library(sf)           # to handle spatial vector data
library(terra)        # To handle raster data
library(lubridate)    # To handle dates and times

```

Import the downloaded csv and create a Spatial Object.

```{r}

wildschwein_BE <- read_delim("wildschwein_BE_2056.csv",",") # adjust path
View(wildschwein_BE)

wildschwein_BE <- st_as_sf(wildschwein_BE, coords = c("E", "N"), crs = 2056, remove = FALSE)
wildschwein_BE

```

### Task 2: Getting an overview

Calculate the time-lag between subsequent positions.

```{r}

wildschwein <- mutate(wildschwein_BE,timelag_s = as.integer(difftime(time1 = lead(DatetimeUTC), time2 = DatetimeUTC), units = "secs"))
wildschwein

```

How many individuals were tracked?

```{r}

wildschwein <- group_by(wildschwein,TierID)
wildschwein

nr_individual <- wildschwein %>% 
  group_keys()  %>% 
  nrow()
nr_individual

```

For how long were the individual tracked? Are there gaps? Were all individuals tracked concurrently or sequentially?

```{r}

ggplot(data = wildschwein, aes(x = DatetimeUTC, y = TierID)) +
  geom_line()

ggplot(data = wildschwein, aes(x = TierID, y = timelag_s)) +
  geom_boxplot()

# find and replace outliers with NA
wildschwein$timelag_s[wildschwein$timelag_s<=0]<-NA

ggplot(data = wildschwein, aes(x = TierID, y = timelag_s)) +
  geom_boxplot()

summary <- wildschwein %>%
  group_by(TierID) %>%
  summarise(         
    max = max(DatetimeUTC),
    min = min(DatetimeUTC),
    total_timelag = difftime(time1 = max, time2 = min),
    mean_timelag = mean(timelag_s, na.rm = T),
    sd_timelag = sd(timelag_s, na.rm = T),
    timelag_gabs = sum(is.na(timelag_s)))
summary

```

What is the temporal sampling interval between the locations?

```{r}

ggplot(data = wildschwein, aes(x = timelag_s)) +
  geom_histogram(bins = 100)

ggplot(data = wildschwein, aes(x = timelag_s)) +
  geom_histogram(bins = 200) + 
  scale_x_continuous(limits=c(0,4000))

```


### Task 3: Deriving movement parameters I: Speed

Calculate the Euclidean distance (steplength) and the speed.

```{r}

wildschwein <- wildschwein %>%
  mutate(steplength_m = sqrt((E-lead(E,1))^2 + (N-lead(N,1))^2),
         speed_m_s = steplength_m / timelag_s)

View(wildschwein)

```

